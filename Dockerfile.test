FROM node:22-slim

WORKDIR /app

# Install pnpm using the same method as GitHub Actions
RUN npm install -g pnpm@latest

# Copy package files
COPY package.json pnpm-lock.yaml ./

# Install dependencies
RUN pnpm install --frozen-lockfile

# Copy source files
COPY . .

# Create test directory and files
RUN mkdir -p project-briefs/test && \
    echo '{"projectName":"Test Bot","projectKey":"test-bot","projectDescription":"A test bot","targetAudience":"Test users","keyFeatures":"Test features","technicalRequirements":"Test requirements","timeline":"1 week","budget":"$1000","additionalNotes":"Test notes"}' > project-briefs/test/test-bot.json

# Set environment variables to match CI
ENV NODE_ENV=test
ENV NODE_NO_WARNINGS=1 